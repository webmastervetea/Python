# Soporte: https://www.linkedin.com/in/oscarlizarragag/

# Este script requiere dos librer铆as externas:

# \# 1. **python-barcode:** Para generar la l贸gica del c贸digo.

# \# 2. **Pillow (PIL):** Para guardar el c贸digo generado como un archivo de imagen (PNG).

# \# Puedes instalarlas con: `pip install python-barcode Pillow`

```python
import os
import sys
import tkinter as tk
from tkinter import filedialog, messagebox, ttk
from barcode import EAN13, Code128
from barcode.writer import ImageWriter

# --- CONFIGURACIN DE BARCODE ---

# # Mapeo de tipos de c贸digo disponibles para el usuario
TIPOS_CODIGO = {
    "EAN-13 (Productos minoristas)": "ean13",
    "Code 128 (Uso general)": "code128"
}

def generar_codigo_barras_como_imagen(tipo_codigo, datos, ruta_guardar):
    """
    Genera el c贸digo de barras especificado y lo guarda como un archivo de imagen.

    :param tipo_codigo: 'ean13' o 'code128'.
    :param datos: La secuencia num茅rica o alfanum茅rica del c贸digo.
    :param ruta_guardar: Ruta completa del archivo de imagen de salida (ej: 'codigo.png').
    :return: True si se guarda con 茅xito, False en caso contrario.
    """
    
    # 1. Seleccionar la clase de c贸digo de barras
    if tipo_codigo == "ean13":
        # # EAN-13 requiere 12 o 13 d铆gitos
        ClaseBarcode = EAN13
        longitud_esperada = 12
    elif tipo_codigo == "code128":
        # # Code 128 acepta cualquier longitud alfanum茅rica
        ClaseBarcode = Code128
        longitud_esperada = 0 # No hay longitud fija

    # 2. Validaci贸n de datos
    if ClaseBarcode == EAN13:
        # # Para EAN-13, comprobamos que sean solo d铆gitos y la longitud correcta
        if not datos.isdigit() or len(datos) != longitud_esperada:
            messagebox.showerror("Error de Datos", 
                                 f"EAN-13 requiere exactamente {longitud_esperada} d铆gitos num茅ricos.")
            return False
    # # Para Code 128, la librer铆a har谩 la validaci贸n interna si hay caracteres no soportados.

    try:
        # 3. Crear el objeto Barcode
        # # La librer铆a calcula autom谩ticamente el d铆gito de control si se le dan 12 d铆gitos para EAN13.
        barcode_instance = ClaseBarcode(datos, writer=ImageWriter())
        
        # 4. Guardar el c贸digo como imagen PNG
        # # El m茅todo `write` guarda el archivo. El nombre es la ruta_guardar sin extensi贸n.
        # # # `module_height`: altura de las barras. `text_distance`: espacio entre barras y texto.
        barcode_instance.write(
            ruta_guardar, 
            options={'module_height': 15, 'text_distance': 5, 'font_size': 12, 'write_text': True}
        )
        
        return True
        
    except Exception as e:
        messagebox.showerror("Error de Generaci贸n", 
                             f"Fallo al generar el c贸digo. Aseg煤rate de que los datos sean v谩lidos. Detalles: {e}")
        return False


class GeneradorBarcodeApp:
    """
    Clase que gestiona la Interfaz Gr谩fica (GUI).
    """
    def __init__(self, master):
        self.master = master
        master.title("Generador de C贸digos de Barras")
        master.geometry("400x350")
        master.config(padx=10, pady=10)

        # Variables de Control
        self.tipo_codigo = tk.StringVar(value=list(TIPOS_CODIGO.keys())[0]) # EAN-13 por defecto
        self.datos_entrada = tk.StringVar()

        self.crear_widgets()

    def crear_widgets(self):
        """Crea y coloca todos los widgets de la interfaz."""
        
        # --- TTULO ---
        tk.Label(self.master, 
                 text="Generador de C贸digo de Barras", 
                 font=('Arial', 14, 'bold')).pack(pady=10)
        
        # --- Frame de Configuraci贸n ---
        frame_config = tk.LabelFrame(self.master, text="Configuraci贸n", padx=10, pady=10)
        frame_config.pack(fill="x", pady=10)

        # Tipo de C贸digo (Combobox)
        tk.Label(frame_config, text="Tipo de C贸digo:").grid(row=0, column=0, sticky="w", pady=5)
        ttk.Combobox(frame_config, 
                     textvariable=self.tipo_codigo, 
                     values=list(TIPOS_CODIGO.keys()),
                     state="readonly").grid(row=0, column=1, sticky="ew", padx=5)

        # Datos de Entrada
        tk.Label(frame_config, text="Datos a Codificar:").grid(row=1, column=0, sticky="w", pady=5)
        tk.Entry(frame_config, textvariable=self.datos_entrada, width=30).grid(row=1, column=1, sticky="ew", padx=5)

        # --- Bot贸n de Generaci贸n ---
        tk.Button(self.master, 
                  text="GENERAR Y GUARDAR IMAGEN", 
                  command=self.solicitar_guardado,
                  bg='#00B0FF', fg='white', 
                  font=('Arial', 12, 'bold')).pack(pady=20, fill='x')

        # --- Notas de Uso ---
        tk.Label(self.master, 
                 text="* EAN-13: Requiere 12 d铆gitos (ej: 012345678901)\n* Code 128: Cualquier texto/n煤mero",
                 justify=tk.LEFT,
                 fg='gray').pack(pady=5)

    def solicitar_guardado(self):
        """
        Pide al usuario la ubicaci贸n para guardar la imagen y llama a la funci贸n de generaci贸n.
        """
        datos = self.datos_entrada.get().strip()
        nombre_tipo = self.tipo_codigo.get()
        tipo_codigo_id = TIPOS_CODIGO[nombre_tipo]

        if not datos:
            messagebox.showerror("Error", "Por favor, introduce los datos a codificar.")
            return

        # 1. Solicitar ruta para guardar el archivo
        nombre_por_defecto = f"{tipo_codigo_id}_{datos}.png"
        ruta_guardar = filedialog.asksaveasfilename(
            defaultextension=".png",
            initialfile=nombre_por_defecto,
            title="Guardar imagen del C贸digo de Barras",
            filetypes=[("Archivos PNG", "*.png")]
        )
        
        if not ruta_guardar:
            return # Cancelado por el usuario

        # 2. Generar y guardar
        if generar_codigo_barras_como_imagen(tipo_codigo_id, datos, ruta_guardar.replace('.png', '')):
            messagebox.showinfo("xito", f"C贸digo de barras generado y guardado en:\n{ruta_guardar}")


# --- Bloque Principal de Ejecuci贸n ---

def main():
    # # Verificar dependencias antes de intentar ejecutar
    try:
        import barcode
        from PIL import Image # Pillow se importa internamente por ImageWriter
    except ImportError:
        messagebox.showerror("Error de Librer铆a", 
                             "Faltan librer铆as: Ejecuta 'pip install python-barcode Pillow'")
        sys.exit(1)
        
    root = tk.Tk()
    app = GeneradorBarcodeApp(root)
    print("# Generador de C贸digo de Barras iniciado. Introduce los datos y guarda la imagen.")
    root.mainloop()

if __name__ == "__main__":
    # # Necesitamos una instancia de Tkinter para los cuadros de di谩logo de error, 
    # # # incluso si la app falla al inicio.
    root_temp = tk.Tk()
    root_temp.withdraw() 
    main()
```

##  Instrucciones para Usar el Programa

1.  **Instala las librer铆as necesarias:** Abre tu terminal y ejecuta:
    ```bash
    pip install python-barcode Pillow
    ```
2.  **Guarda el c贸digo:** Guarda el c贸digo Python anterior en un archivo, por ejemplo, `generador_barcode.py`.
3.  **Ejecuta el script:** Abre tu terminal y ejecuta:
    ```bash
    python generador_barcode.py
    ```
4.  **Genera el C贸digo:**
      * **Selecciona el Tipo:** Elige **EAN-13** o **Code 128** en el men煤 desplegable.
      * **Introduce los Datos:**
          * Para **EAN-13**, introduce 12 d铆gitos (el 13潞 d铆gito de control se calcula autom谩ticamente).
          * Para **Code 128**, introduce cualquier texto o n煤mero.
      * Haz clic en **"GENERAR Y GUARDAR IMAGEN"** y selecciona la ubicaci贸n para guardar el archivo PNG resultante.

# El script utiliza **ImageWriter** de `python-barcode` (que requiere Pillow) para generar un archivo PNG de alta calidad.




