# Soporte: https://www.linkedin.com/in/oscarlizarragag/

# Este script utiliza la librer√≠a **google-api-python-client** para interactuar con Google Drive.

# \# La configuraci√≥n es la parte m√°s compleja, ya que requiere credenciales OAuth 2.0.

## ‚ö†Ô∏è Pasos Previos Necesarios (¬°CRUCIALES\!)

# \# 1. **Activar la API de Google Drive:** Ve a Google Cloud Console.

# \# 2. **Crear un Proyecto:** Crea un nuevo proyecto.

# \# 3. **Habilitar la API:** Busca y habilita "Google Drive API".

# \# 4. **Crear Credenciales:** Ve a "Credenciales" \> "Crear credenciales" \> "ID de cliente de OAuth".

# \# 5. **Tipo de Aplicaci√≥n:** Selecciona "Aplicaci√≥n de escritorio" (Desktop App) y crea.

# \# 6. **Descargar `credentials.json`:** Descarga el archivo JSON generado. **Ren√≥mbralo a `credentials.json`** y col√≥calo en el mismo directorio que este script.

# \--- DEPENDENCIAS ---

# \# Debes instalar las librer√≠as necesarias:

# \# pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib

```python
import os
import io
import tkinter as tk
from tkinter import filedialog, messagebox

# # Librer√≠as de Google Drive
from google.auth.transport.requests import Request
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from googleapiclient.discovery import build
from googleapiclient.http import MediaFileUpload, MediaIoBaseDownload

# --- CONFIGURACI√ìN DE LA API ---

# # Si se modifican estos alcances, el archivo token.json debe eliminarse.
SCOPES = ['https://www.googleapis.com/auth/drive.file']
# # Este alcance limita el acceso solo a los archivos creados o abiertos por esta aplicaci√≥n.
TOKEN_FILE = 'token.json'
CREDENTIALS_FILE = 'credentials.json'

def autenticar_google_drive():
    """
    Gestiona el proceso de autenticaci√≥n OAUTH2.
    Carga las credenciales guardadas o inicia el flujo de autenticaci√≥n si es necesario.
    
    :return: Objeto Credentials o None si falla.
    """
    creds = None
    # 1. Intentar cargar el token previamente guardado
    if os.path.exists(TOKEN_FILE):
        creds = Credentials.from_authorized_user_file(TOKEN_FILE, SCOPES)

    # 2. Si las credenciales son inv√°lidas o no existen, iniciar el flujo
    if not creds or not creds.valid:
        if creds and creds.expired and creds.refresh_token:
            # # Si expir√≥, intentar refrescar el token
            creds.refresh(Request())
        else:
            # # Iniciar el flujo de autenticaci√≥n (abrir√° una ventana del navegador)
            if not os.path.exists(CREDENTIALS_FILE):
                messagebox.showerror("Error de Autenticaci√≥n", 
                                     f"El archivo de credenciales '{CREDENTIALS_FILE}' no se encontr√≥.\n"
                                     "Consulta los pasos CRUCIALES al inicio del script.")
                return None
                
            flow = InstalledAppFlow.from_client_secrets_file(CREDENTIALS_FILE, SCOPES)
            creds = flow.run_local_server(port=0)

        # 3. Guardar las nuevas credenciales para futuras ejecuciones
        with open(TOKEN_FILE, 'w') as token:
            token.write(creds.to_json())
            
    return creds

def subir_archivo_a_drive(ruta_archivo_local):
    """
    Sube el archivo especificado a la ra√≠z de Google Drive.

    :param ruta_archivo_local: Ruta completa al archivo en la m√°quina local.
    """
    # 1. Autenticaci√≥n
    creds = autenticar_google_drive()
    if not creds:
        print("# ‚ùå Subida cancelada por fallo en la autenticaci√≥n.")
        return

    try:
        # 2. Conectar al servicio de Drive
        service = build('drive', 'v3', credentials=creds)
        
        nombre_archivo = os.path.basename(ruta_archivo_local)
        
        # 3. Definir los metadatos y el tipo MIME
        file_metadata = {'name': nombre_archivo}
        
        # # `mimetypes.guess_type` podr√≠a usarse aqu√≠, pero para simplificar, lo omitimos.
        # # # MediaFileUpload adivinar√° el tipo MIME.
        media = MediaFileUpload(ruta_archivo_local, resumable=True)

        # 4. Realizar la subida
        # # El par√°metro 'body' son los metadatos y 'media_body' es el contenido del archivo.
        file = service.files().create(body=file_metadata, media_body=media, fields='id, name').execute()

        print(f"\n# ‚úÖ Archivo subido con √©xito.")
        print(f"# Nombre: {file.get('name')}")
        print(f"# ID de Drive: {file.get('id')}")
        
        messagebox.showinfo("√âxito de Subida", 
                            f"Archivo '{file.get('name')}' subido a Google Drive (ra√≠z) con √©xito.")

    except Exception as e:
        print(f"\n# ‚ùå ERROR al subir el archivo: {e}")
        messagebox.showerror("Error de Subida", f"Fallo al subir el archivo a Drive: {e}")


# --- Bloque Principal de Ejecuci√≥n (con GUI para seleccionar archivo) ---

def main():
    # # Inicializar Tkinter para los di√°logos gr√°ficos
    root = tk.Tk()
    root.withdraw() 
    
    print("# --- SUBIDA AUTOM√ÅTICA A GOOGLE DRIVE ---")
    
    # # Advertencia inicial sobre la autenticaci√≥n
    print(f"# üí° Buscando '{CREDENTIALS_FILE}' y 'token.json'...")
    
    # # Abrir di√°logo para seleccionar el archivo local
    ruta_archivo = filedialog.askopenfilename(
        title="Seleccione el archivo local a subir a Google Drive"
    )
    
    if not ruta_archivo:
        print("# Operaci√≥n cancelada por el usuario. Saliendo.")
        sys.exit(0)
        
    if not os.path.exists(ruta_archivo):
        messagebox.showerror("Error", "El archivo seleccionado no existe.")
        sys.exit(1)

    subir_archivo_a_drive(ruta_archivo)

if __name__ == "__main__":
    main()
```

## üìù Instrucciones para Usar el Programa

1.  **Instala las dependencias de Google:**
    ```bash
    pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib
    ```
2.  **Sigue los Pasos CRUCIALES:** Aseg√∫rate de haber completado los 6 pasos previos para obtener el archivo **`credentials.json`** de Google Cloud Console y colocarlo junto a este script.
3.  **Guarda y Ejecuta:** Guarda el c√≥digo Python (`subida_drive.py`) y ejec√∫talo:
    ```bash
    python subida_drive.py
    ```
4.  **Autenticaci√≥n (Solo la primera vez):** La primera vez que ejecutes el script, se abrir√° una ventana del navegador pidi√©ndote que inicies sesi√≥n en tu cuenta de Google y que otorgues permisos a la aplicaci√≥n para que acceda a Google Drive. **Acepta los permisos.**
5.  **Selecciona el Archivo:** Una vez autenticado, se te pedir√° que elijas el archivo local que deseas subir.
6.  **Verifica:** El archivo aparecer√° en la ra√≠z de tu Google Drive.

# Este script maneja la autenticaci√≥n y la subida de un archivo individual a la carpeta ra√≠z de tu Google Drive.




